{% extends "base.html" %} {% block title %}Patient Health Report{% endblock %}
{% block extra_css %} /* Colors & Variables */ :root { --color-heading: #0f172a;
/* Slate 900 */ --color-text: #475569; /* Slate 600 - LIGHTER than headings */
--color-accent: #0ea5e9; /* Sky 500 */ --bg-color: #ffffff; --border-color:
#e2e8f0; /* Slate 200 */ /* Status Text Colors */ --status-good: #10b981; /*
Emerald 500 */ --status-warning: #f59e0b; /* Amber 500 */ --status-danger:
#ef4444; /* Red 500 */ } body { font-family: 'Inter', system-ui, -apple-system,
sans-serif; color: var(--color-text); /* Lighter body text */ background-color:
var(--bg-color); line-height: 1.6; } /* Redesigned Minimal Header */ .header-bar
{ display: flex; justify-content: space-between; align-items: center;
padding-bottom: 2rem; margin-bottom: 2rem; border-bottom: 3px solid
var(--color-heading); /* Separation line */ } .header-brand { font-size: 10pt;
font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; color:
var(--color-heading); } .header-meta { text-align: right; } .report-id {
font-size: 9pt; color: #94a3b8; } .report-date { font-size: 14pt; font-weight:
600; color: var(--color-heading); } /* Overview Section (Hero) */
.overview-section { display: flex; gap: 3rem; align-items: flex-start;
margin-bottom: 3rem; background: #f8fafc; border-radius: 12px; padding: 2rem; }
/* Pie Chart */ .pie-chart { width: 140px; height: 140px; border-radius: 50%; /*
Fallback */ background-color: var(--status-good); position: relative;
flex-shrink: 0; -webkit-print-color-adjust: exact !important;
print-color-adjust: exact !important; } .pie-chart::after { content: ""; /*
Donut hole */ position: absolute; top: 50%; left: 50%; transform:
translate(-50%, -50%); width: 90px; height: 90px; background: #f8fafc; /*
Matches container bg */ border-radius: 50%; } .score-center { position:
absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align:
center; z-index: 10; } .score-val { font-size: 24pt; font-weight: 800;
line-height: 1; color: var(--color-heading); display: block; } .score-lbl {
font-size: 8pt; text-transform: uppercase; letter-spacing: 0.05em; font-weight:
600; } .overview-content { flex-grow: 1; } .overview-title { font-size: 14pt;
font-weight: 700; color: var(--color-heading); margin-bottom: 0.75rem; } /*
Section Headings */ .section-title { font-size: 18pt; font-weight: 700; color:
var(--color-heading); margin-top: 3rem; margin-bottom: 1.5rem; border-bottom:
2px solid var(--border-color); padding-bottom: 0.5rem; } .system-card {
margin-bottom: 3rem; /* Separator between systems if desired */ /*
border-bottom: 1px dashed var(--border-color); */ padding-bottom: 1rem; }
.system-header { display: flex; align-items: baseline; justify-content:
space-between; margin-bottom: 1rem; } .system-name { font-size: 14pt;
font-weight: 700; color: var(--color-heading); } .system-status { font-weight:
600; font-size: 11pt; } /* Table Styling */ .biomarker-table { width: 100%;
border-collapse: collapse; margin-bottom: 1rem; font-size: 10pt; }
.biomarker-table th { text-align: left; padding: 12px 10px; border-bottom: 2px
solid var(--border-color); color: var(--color-text); font-weight: 600;
font-size: 9pt; text-transform: uppercase; } .biomarker-table td { padding: 12px
10px; vertical-align: top; border-bottom: 1px solid var(--border-color); }
.col-measure { width: 35%; } .biomarker-name { font-weight: 700; color:
var(--color-heading); display: block; } .biomarker-def { font-size: 8.5pt;
color: #64748b; font-style: italic; display: block; margin-top: 2px; }
.col-value { width: 20%; font-family: 'Roboto Mono', monospace; font-weight:
600; color: var(--color-heading); } .col-range { width: 25%; font-size: 9pt; }
.col-status { width: 20%; font-weight: 600; } /* Explanation Box - Integrated
into table row */ .explanation-content { background: #f8fafc; padding: 1rem;
border-radius: 6px; font-size: 9.5pt; color: var(--color-text); line-height:
1.6; } .explanation-content b { color: var(--color-heading); font-weight: 600; }
/* Status Colors */ .text-good { color: var(--status-good); } .text-warn {
color: var(--status-warning); } .text-danger { color: var(--status-danger); }
.text-neutral { color: #94a3b8; } /* Recommendations */ .rec-grid { display:
grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; } .rec-item { background:
white; border: 1px solid var(--border-color); padding: 1.5rem; border-radius:
8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); /* Subtle shadow */ }
.rec-text { font-size: 10.5pt; color: var(--color-text); } {% endblock %} {%
block content %}

<!-- Enhanced Header with Executive Summary -->
<div class="header-bar">
	<div class="header-brand">Chiranjeevi AI</div>
	<div class="header-meta">
		<div class="report-date">
			{{ report.generated_at.strftime('%B %d, %Y') }}
		</div>
		<div class="report-id">ID: {{ report.report_id }}</div>
	</div>
</div>

<!-- Executive Summary Hero Section -->
<div
	style="
		background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
		color: white;
		padding: 2rem;
		border-radius: 12px;
		margin-bottom: 2rem;
		-webkit-print-color-adjust: exact !important;
		print-color-adjust: exact !important;
	"
>
	<div
		style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem"
	>
		<div style="font-size: 32pt; font-weight: 800; line-height: 1">
			{{ "%.0f"|format(report.overall_risk_score) }}
		</div>
		<div style="flex-grow: 1">
			<div
				style="
					font-size: 11pt;
					font-weight: 600;
					text-transform: uppercase;
					letter-spacing: 0.05em;
					opacity: 0.9;
				"
			>
				Overall Health Score
			</div>
			<div style="font-size: 9pt; opacity: 0.8">
				Based on {{ report.system_summaries|length }} physiological systems
			</div>
		</div>
	</div>
	<div
		style="
			font-size: 11pt;
			line-height: 1.6;
			opacity: 0.95;
			border-top: 1px solid rgba(255, 255, 255, 0.3);
			padding-top: 1rem;
			margin-top: 1rem;
		"
	>
		{{ executive_summary|safe }}
	</div>
</div>

<!-- Quick Stats Cards -->
{% set risks = namespace(low=0, mod=0, high=0) %} {% for s in
report.system_summaries.values() %} {% if s.risk_level|lower == 'low' %}{% set
risks.low = risks.low + 1 %} {% elif s.risk_level|lower == 'moderate' %}{% set
risks.mod = risks.mod + 1 %} {% else %}{% set risks.high = risks.high + 1 %}{%
endif %} {% endfor %}

<div
	style="
		display: grid;
		grid-template-columns: 1fr 1fr 1fr;
		gap: 1rem;
		margin-bottom: 2rem;
	"
>
	<div
		style="
			background: #f0fdf4;
			border: 2px solid #86efac;
			padding: 1.25rem;
			border-radius: 8px;
			text-align: center;
		"
	>
		<div style="font-size: 24pt; font-weight: 700; color: #10b981">
			{{ risks.low }}
		</div>
		<div
			style="
				font-size: 9pt;
				color: #047857;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
			"
		>
			Healthy Systems
		</div>
	</div>
	<div
		style="
			background: #fffbeb;
			border: 2px solid #fcd34d;
			padding: 1.25rem;
			border-radius: 8px;
			text-align: center;
		"
	>
		<div style="font-size: 24pt; font-weight: 700; color: #f59e0b">
			{{ risks.mod }}
		</div>
		<div
			style="
				font-size: 9pt;
				color: #d97706;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
			"
		>
			Need Attention
		</div>
	</div>
	<div
		style="
			background: #fef2f2;
			border: 2px solid #fca5a5;
			padding: 1.25rem;
			border-radius: 8px;
			text-align: center;
		"
	>
		<div style="font-size: 24pt; font-weight: 700; color: #ef4444">
			{{ risks.high }}
		</div>
		<div
			style="
				font-size: 9pt;
				color: #dc2626;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
			"
		>
			Critical Findings
		</div>
	</div>
</div>

<!-- Detailed Analysis -->
<div class="section-title">Detailed System Analysis</div>

{% for system, summary in report.system_summaries.items() %}
<div class="system-card">
	<div class="system-header">
		<div class="system-name">
			{{ system.value|replace("_", " ")|title }} System
		</div>
		<div
			class="system-status {% if summary.risk_level|lower == 'low' %}text-good {% elif summary.risk_level|lower == 'moderate' %}text-warn {% else %}text-danger{% endif %}"
		>
			{{ summary.status }}
		</div>
	</div>

	{% if summary.biomarkers %}
	<table class="biomarker-table">
		<thead>
			<tr>
				<th class="col-measure">What We Measured</th>
				<th class="col-value">Your Value</th>
				<th class="col-range">Normal Range</th>
				<th class="col-status">Status</th>
			</tr>
		</thead>
		<tbody>
			{% for name, data in summary.biomarkers.items() %}
			<tr>
				<td>
					<span class="biomarker-name"
						>{{ biomarker_names.get(name, name|replace("_", " ")|title) }}</span
					>
					{% if data.definition %}
					<span class="biomarker-def">* {{ data.definition }}</span>
					{% endif %}
				</td>
				<td class="col-value">
					{{ data.value }}
					<span style="font-size: 0.8em; color: #94a3b8; font-weight: 400"
						>{{ data.unit }}</span
					>
				</td>
				<td class="col-range">{{ data.normal_range }}</td>
				<td class="col-status">
					{% if 'normal' in data.status|lower or 'good' in data.status|lower %}
					<span class="text-good">✓ Healthy</span>
					{% elif 'low' in data.status|lower %}
					<span class="text-warn">⚠ Low</span>
					{% elif 'high' in data.status|lower %}
					<span class="text-warn">⚠ High</span>
					{% else %}
					<span class="text-neutral">--</span>
					{% endif %}
				</td>
			</tr>
			<!-- Integrated Explanation Row -->
			<tr>
				<td
					colspan="4"
					style="padding-top: 0; border-bottom: 1px solid var(--border-color)"
				>
					<div
						class="explanation-content"
						style="margin-top: 4px; margin-bottom: 12px"
					>
						{{ data.explanation|safe }}
					</div>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% endif %}

	<!-- System Level Note -->
	{% if summary.explanation %}
	<div
		style="
			background: #fff7ed;
			color: #c2410c;
			padding: 1rem;
			border-radius: 6px;
			font-size: 9.5pt;
			margin-top: 1rem;
		"
	>
		<strong>Note:</strong> {{ summary.explanation|safe }}
	</div>
	{% endif %}
</div>
{% endfor %}

<!-- Recommendations -->
{% if report.recommendations %}
<div class="section-title">Recommendations</div>
<div class="rec-grid">
	{% for rec in report.recommendations %}
	<div class="rec-item">
		<div class="rec-text">{{ rec|safe }}</div>
	</div>
	{% endfor %}
</div>
{% endif %}

<!-- Footer -->
<div
	style="margin-top: 5rem; text-align: center; color: #cbd5e1; font-size: 8pt"
>
	&copy; 2026 Chiranjeevi AI. Screening results are not a medical diagnosis.
</div>

{% endblock %}
